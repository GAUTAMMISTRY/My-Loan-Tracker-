<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Home Loan Tracker</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<!-- Bootstrap -->
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">

<!-- jQuery -->
<script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>

<!-- Chart.js -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<!-- Excel -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>

<style>
body { background:#f4f6f9; }
.card { border-radius:15px; }
.paid-row { background:#d4edda!important; }
.remaining-row { background:#ffffff; }
.table thead { background:#0d6efd; color:#fff; }
.summary-box { font-size:16px; }
@media(max-width:768px){
  h2{font-size:22px;}
}
</style>
</head>

<body>

<div class="container mt-3">
<h2 class="text-center mb-3">üè† Home Loan Tracker</h2>

<!-- INPUT -->
<div class="card shadow p-3">
  <div class="row g-2">
    <div class="col-12 col-md-3">
      <label>First EMI Date</label>
      <input type="date" id="firstEmiDate" class="form-control">
    </div>
    <div class="col-6 col-md-2">
      <label>Tenure (Years)</label>
      <input type="number" id="tenure" class="form-control">
    </div>
    <div class="col-6 col-md-3">
      <label>Loan Amount (‚Çπ)</label>
      <input type="number" id="loanAmount" class="form-control">
    </div>
    <div class="col-6 col-md-2">
      <label>Interest %</label>
      <input type="number" step="0.01" id="interest" class="form-control">
    </div>
    <div class="col-6 col-md-2 d-grid">
      <label>&nbsp;</label>
      <button id="calculate" class="btn btn-primary">Calculate</button>
    </div>
  </div>
</div>

<!-- RESULT -->
<div id="result" class="mt-4" style="display:none;">

  <!-- SUMMARY ROW 1 -->
  <div class="row text-center">
    <div class="col-md-4 col-12">
      <div class="card shadow p-2 summary-box">
        <strong>Total Paid Till Today</strong><br>
        ‚Çπ <span id="totalPaid"></span>
      </div>
    </div>
    <div class="col-md-4 col-12">
      <div class="card shadow p-2 summary-box">
        <strong>Remaining Loan</strong><br>
        ‚Çπ <span id="remainingLoan"></span>
      </div>
    </div>
    <div class="col-md-4 col-12">
      <div class="card shadow p-2 summary-box">
        <strong>Monthly EMI</strong><br>
        ‚Çπ <span id="emiAmount"></span>
      </div>
    </div>
  </div>

  <!-- SUMMARY ROW 2 (NEW CARD) -->
  <div class="row text-center mt-2">
    <div class="col-md-4 col-12 mx-auto">
      <div class="card shadow p-2 summary-box border-success">
        <strong>Total Amount (With Interest)</strong><br>
        ‚Çπ <span id="totalPayable"></span>
      </div>
    </div>
  </div>

  <!-- BUTTONS -->
  <div class="row mt-3">
    <div class="col-6 d-grid">
      <button class="btn btn-success" onclick="exportExcel()">Export Excel</button>
    </div>
    <div class="col-6 d-grid">
      <button class="btn btn-dark" onclick="scrollToChart()">View Chart</button>
    </div>
  </div>

  <!-- TABLE -->
  <div class="card shadow mt-3">
    <div class="card-body table-responsive">
      <table class="table table-bordered table-sm">
        <thead>
          <tr>
            <th>EMI Date</th>
            <th>Principal</th>
            <th>Interest</th>
            <th>EMI</th>
            <th>Balance</th>
          </tr>
        </thead>
        <tbody id="emiTable"></tbody>
      </table>
    </div>
  </div>

  <!-- CHART -->
  <div class="card shadow mt-3" id="chartSection">
    <div class="card-body">
      <canvas id="emiChart"></canvas>
    </div>
  </div>

</div>
</div>

<script>
let chart;

$("#calculate").click(function(){

  let firstEmiDateVal = $("#firstEmiDate").val();
  let tenureYears = +$("#tenure").val();
  let loanAmount = +$("#loanAmount").val();
  let interest = +$("#interest").val();

  if(!firstEmiDateVal || !tenureYears || !loanAmount || !interest){
    alert("Please fill all fields");
    return;
  }

  let firstEmiDate = new Date(firstEmiDateVal);
  let months = tenureYears * 12;
  let rate = interest / 12 / 100;

  let emi = loanAmount * rate * Math.pow(1+rate,months) /
            (Math.pow(1+rate,months)-1);
  emi = Math.round(emi);

  let totalPayable = emi * months;

  let balance = loanAmount;
  let remainingBalance = loanAmount;
  let totalPaid = 0;

  let today = new Date();
  let labels=[], principalArr=[], interestArr=[], balanceArr=[];

  $("#emiTable").html("");

  for(let i=0;i<months;i++){

    let emiDate = new Date(firstEmiDate);
    emiDate.setMonth(firstEmiDate.getMonth() + i);

    let interestPart = Math.round(balance * rate);
    let principalPart = emi - interestPart;
    balance -= principalPart;
    if(balance < 0) balance = 0;

    let paid = emiDate <= today;
    if(paid){
      totalPaid += emi;
      remainingBalance = balance;
    }

    let rowClass = paid ? "paid-row":"remaining-row";

    labels.push(emiDate.toLocaleDateString("en-IN"));
    principalArr.push(principalPart);
    interestArr.push(interestPart);
    balanceArr.push(balance);

    $("#emiTable").append(`
      <tr class="${rowClass}">
        <td>${emiDate.toLocaleDateString("en-IN")}</td>
        <td>${principalPart.toLocaleString()}</td>
        <td>${interestPart.toLocaleString()}</td>
        <td>${emi.toLocaleString()}</td>
        <td>${Math.round(balance).toLocaleString()}</td>
      </tr>
    `);
  }

  $("#emiAmount").text(emi.toLocaleString());
  $("#totalPaid").text(totalPaid.toLocaleString());
  $("#remainingLoan").text(Math.round(remainingBalance).toLocaleString());
  $("#totalPayable").text(totalPayable.toLocaleString());

  $("#result").fadeIn();
  $('html,body').animate({scrollTop:$("#result").offset().top},500);

  renderChart(labels,principalArr,interestArr,balanceArr);
});

function renderChart(labels,p,i,b){
  if(chart) chart.destroy();
  chart = new Chart(document.getElementById("emiChart"),{
    type:"line",
    data:{
      labels,
      datasets:[
        {label:"Principal",data:p},
        {label:"Interest",data:i},
        {label:"Balance",data:b}
      ]
    },
    options:{responsive:true}
  });
}

function exportExcel(){
  let wb = XLSX.utils.table_to_book(document.querySelector("table"));
  XLSX.writeFile(wb,"Home_Loan_EMI.xlsx");
}
function scrollToChart(){
  $('html,body').animate({scrollTop:$("#chartSection").offset().top},500);
}
</script>

</body>
</html>


